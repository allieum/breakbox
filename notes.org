#+title: Notes

* pride preppers
** DONE lower than halftime still halftime
CLOSED: [2023-06-11 Sun 10:51]
** DONE fix step repeat for shorter samples
CLOSED: [2023-06-11 Sun 08:30]
** DONE fix slower
CLOSED: [2023-06-11 Sun 07:58]
** DONE pitch mod buttons
CLOSED: [2023-06-11 Sun 17:40]
** DONE quantize
CLOSED: [2023-06-11 Sun 17:54]
** DONE dont daisy chain samples into fx chain casualties
CLOSED: [2023-06-11 Sun 17:54]
** DONE pitch mod persistence
CLOSED: [2023-06-11 Sun 17:55]
** bugs where selected sample changes before key release handler
** shift to hold fx
** stop fx button (shift + stop)
** gate period powers of 2
** for gate mirror use presets
** restrict input range of gate time
** release step repeat key -> others should remain active
** effect btns as momentary unmutes
** instead of invert gates, scramble?
*




** spice n dice
** normalize volumes, remove click etc
** combinations of step repeat keys
** sample flipping!!
** error about float / generate sound?
* MVP
** DONE stop audio on start / stop
CLOSED: [2023-04-28 Fri 15:24]
** frame size
** mute switch
** DONE fix out of sync on first loop
CLOSED: [2023-04-28 Fri 15:24]
*** start sample later, or wait til next loop
** DONE dont require tr8s to be on first
CLOSED: [2023-04-28 Fri 15:24]
*** handle case where midi connection goes away
** sample rate / mono?
** survey audio quality / clipping w headphones
*** invest in audio hat for better DAC ?

** DONE systemd service
CLOSED: [2023-05-03 Wed 14:04]
** TODO cpu usage???
:PROPERTIES:
:CREATED:  [2023-05-03 Wed 14:04]
:ID:       3d61d993-b662-4249-9c3a-7d687af9cf6a
:END:

* features
** DONE reduce jitter by only syncing @ start of bar
CLOSED: [2023-05-09 Tue 18:25]
** pitch shifting / rate manipulation
** mute patterns
** probability
** DONE allow play without clock
CLOSED: [2023-05-11 Thu 15:48]
** LFO!
*** for volume, pitch, patterns, prob..


* stuff
** preserve original slice sample thru timestretching
** param dna
** db power amp
** xfade on step repeat ? not sure
** can avoid improper sound queueing? maths?
** recording
** bug w step repeat then toggle not work
** variable bpm
** crossfade
** refactor key handlers
** top row should maybe be toggly / nonexclusive
** implement chromatic rate shift
** DONE fix stutter on start w internal clock
CLOSED: [2023-05-19 Fri 08:59]
** playtest midi clock again lol
** bug with sync at beginning when starting all samples at once?
*** could check queue size and bail to recover from this
*** also when sample drops should get next one in current call (while instead of if for timeout check)


* refactory
** state module (current bank, modes, etc)
** constants
** input / kb module
** audio
** sequence
*** beats, clock, etc
** midi
*** connec, reconnec, get msg
** utility

* bugs
** do HOLD on both step repeat and a toggle switch -> stop doesn't stop the sound

* actually to do
** DONE fix bugs
CLOSED: [2023-04-28 Fri 06:51]
** DONE stop on stop
CLOSED: [2023-04-28 Fri 06:51]
** DONE dont start on start
CLOSED: [2023-04-28 Fri 06:51]
** systemd
** break selection
** detect missing TR8 *optional*
** mute mask fx *optional*

* dactyl keycodes
** 9  10  11  12  13  14
** 49 24  25  26  27  28
** 23 38  39  40  41  42
** 50 52  53  54  55  56
**        23  51      119  50
**                     65  37
**                     36  64

* dactyl pygame keys
** 27  49  50  51  52  53
** 96  113 119 101 114 116
** 23  38  39  40  41  42
** 50  52  53  54  55  56
**        23  51      119  50
**                     65  37
**                     36  64



* stack tracers
1[17664]: 2023-06-11 20:34:18,750 - sample - INFO MainThread:queue_step: 143-2bar-000.bak.wav has 1 step repeat slices for sr length 1, index 8
Jun 11 20:34:18 breakbox python3.11[17664]: 2023-06-11 20:34:18,751 - sample - INFO ThreadPoolExecutor-0_1:timestretch: start stretch x0.005 (0.005 fade), 0.06ms chunks
Jun 11 20:34:18 breakbox python3.11[17664]: 2023-06-11 20:34:18,751 - concurrent.futures - ERROR ThreadPoolExecutor-0_1:_invoke_callbacks: exception calling callback for <Future at 0x715df2f0 state=finished raised AttributeError>
Jun 11 20:34:18 breakbox python3.11[17664]: Traceback (most recent call last):
Jun 11 20:34:18 breakbox python3.11[17664]:   File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 340, in _invoke_callbacks
Jun 11 20:34:18 breakbox python3.11[17664]:     callback(self)
Jun 11 20:34:18 breakbox python3.11[17664]:   File "/home/drum/breakbox/sample.py", line 483, in future_done
Jun 11 20:34:18 breakbox python3.11[17664]:     raise e
Jun 11 20:34:18 breakbox python3.11[17664]:   File "/usr/local/lib/python3.11/concurrent/futures/thread.py", line 58, in run
Jun 11 20:34:18 breakbox python3.11[17664]:     result = self.fn(*self.args, **self.kwargs)
Jun 11 20:34:18 breakbox python3.11[17664]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Jun 11 20:34:18 breakbox python3.11[17664]:   File "/home/drum/breakbox/sample.py", line 282, in <lambda>
Jun 11 20:34:18 breakbox python3.11[17664]:     future = self.audio_executor.submit(lambda: self.queue(generate_sound(), t, step))
Jun 11 20:34:18 breakbox python3.11[17664]:                                                            ^^^^^^^^^^^^^^^^
Jun 11 20:34:18 breakbox python3.11[17664]:   File "/home/drum/breakbox/sample.py", line 587, in timestretch
Jun 11 20:34:18 breakbox python3.11[17664]:     wav = sound.get_raw()
Jun 11 20:34:18 breakbox python3.11[17664]:           ^^^^^^^^^^^^^
Jun 11 20:34:18 breakbox python3.11[17664]: AttributeError: 'float' object has no attribute 'get_raw'

Jun 11 21:00:46 breakbox python3.11[17807]: Traceback (most recent call last):
Jun 11 21:00:46 breakbox python3.11[17807]:   File "/home/drum/breakbox/break.py", line 98, in <module>
Jun 11 21:00:46 breakbox python3.11[17807]:     sequence.update(midi.get_status())
Jun 11 21:00:46 breakbox python3.11[17807]:   File "/home/drum/breakbox/sequence.py", line 124, in update
Jun 11 21:00:46 breakbox python3.11[17807]:     sample.queue_samples(i, t, self.step_duration())
Jun 11 21:00:46 breakbox python3.11[17807]:   File "/home/drum/breakbox/sample.py", line 516, in queue_samples
Jun 11 21:00:46 breakbox python3.11[17807]:     sample.queue_step(step, t, step_duration)
Jun 11 21:00:46 breakbox python3.11[17807]:   File "/home/drum/breakbox/sample.py", line 448, in queue_step
Jun 11 21:00:46 breakbox python3.11[17807]:     if (sound_bpm := sound_data[sound].bpm) != self.bpm:
Jun 11 21:00:46 breakbox python3.11[17807]:                      ^^^^^^^^^^^^^^^^^^^^^
Jun 11 21:00:46 breakbox python3.11[17807]: AttributeError: 'SoundData' object has no attribute 'bpm'
